<!DOCTYPE html>
<html>
<head>
    <!-- Bootstrap -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <title></title>
    <!-- jQuery -->
    <script src="/static/js/jquery-1.7.2.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/static/js/bootstrap.min.js"></script>
    <!-- HighStock -->
    <script src="/static/js/highstock.js"></script>
</head>
<body>
<div class="box-content">

     <script type="text/javascript">
        $(function () {
            var fractalData = []
            var filteredFractalData = []
            $.getJSON('http://127.0.0.1:8080/indicators', function (data) {

                fractalData = data
            })



            $.getJSON('http://127.0.0.1:8080/quotes', function (data) {
                // Create the chart
                var chartdata = []
                var flagslinedata =  []
                var flagsdataBuyOpen = []
                var flagsdataBuyClose = []
                var flagsdataSellOpen = []
                var flagsdataSellClose = []
                //var fractalData = []

                function filldata(){

                    var openPrice = 0;
                    var openTickCount = 0;
                    var tempDates = []
                    var skipline = false
                    for(var i=0; i<data.length; i++){

                        var dateStr = data[i].time.toString()
                        var year = dateStr.slice(0,4)
                        var month = dateStr.slice(4,6)
                        var day = dateStr.slice(6,8)

                        var temp = [
                            Date.parse(year+"/"+month+"/"+day+" 00:00:00"),
                            data[i].open,
                            data[i].high,
                            data[i].low,
                            data[i].close]

                        skipline = false
                        chartdata.push(temp)

                    }
                }

                filldata()
                //console.log(chartdata)
                $('#container').highcharts('StockChart', {

                    rangeSelector: {
                        selected: 1
                    },

                    title: {
                        text: 'EURUSD Price'
                    },
                    series: [
                        {
                            name: 'EURUSD',
                            type: 'candlestick',
                            data: chartdata
                        },
                        {
                            name : 'Result',
                            data : flagslinedata,
                            tooltip: {
                                valueDecimals: 2
                            }
                        },
                        {
                            type : 'flags',
                            data : flagsdataBuyOpen,
                            onSeries : 'dataseries',
                            shape : 'circlepin',
                            color : '#5F86B3',
				            fillColor : '#00ff00',
				            style : {// text style
					            color : 'white'
				            },
                            width : 16
                        },
                        {
                            type : 'flags',
                            data : flagsdataBuyClose,
                            onSeries : 'dataseries',
                            shape : 'squarepin',
                            color : '#5F86B3',
				            fillColor : '#00ff00',
				            style : {// text style
					            color : 'white'
				            },
                            width : 16
                        },
                        {
                            type : 'flags',
                            data : flagsdataSellOpen,
                            onSeries : 'dataseries',
                            shape : 'circlepin',
                            color : '#5F86B3',
				            fillColor : '#ff0000',
				            style : {// text style
					            color : 'white'
				            },
                            width : 16
                        },
                        {
                            type : 'flags',
                            data : flagsdataSellClose,
                            onSeries : 'dataseries',
                            shape : 'squarepin',
                            color : '#5F86B3',
				            fillColor : '#ff0000',
				            style : {// text style
					            color : 'white'
				            },
                            width : 16
                        },
                        {
                            type : 'flags',
                            data : fractalData,
                            onSeries : 'dataseries',
                            shape : 'squarepin',
                            color : '#5F86B3',
				            fillColor : '#0000ff',
				            style : {// text style
					            color : 'white'
				            },
                            point:{
                                events: {
                                    click:function(event){
                                        filteredFractalData.push(this.x)
                                        console.log(filteredFractalData)
                                        alert(filteredFractalData)
                                    }
                                }
                            },
                            width : 16
                        }

                    ]
                });
            });
        });
    </script>
    <div id="container" style="height: 500px; min-width: 500px"></div>

</div>


</body>
</html>